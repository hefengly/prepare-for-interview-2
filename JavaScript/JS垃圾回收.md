## JS GC

> `JavaScript`中，最主要的GC算法有两种：分别是引用计数和标记清除。现在所有现代浏览器都使用标记清除垃圾回收算法



### 引用计数

> 就是把“对象是否不再需要”简化定义为“对象有没有其他对象引用到它”。如果没有引用指向该对象（零引用），对象将被垃圾回收机制回收。

```js
var a = { kim: 1 }	// a变量引用了这个对象
var b = a			// b变量也引用了这个对象，这时这个对象的引用数为2

a = null			// 这时只剩下b引用该对象
b = null			// 这时已经没有变量引用该对象，可以被垃圾回收了
```



> 缺点：循环引用，当有两个变量存在内部循环引用时，无法自动回收掉循环引用的空间

```js
function f () {
    var a = {}
    var b = {}
    // 循环引用
    a.c = b
    b.c = a
}
f()
// 因为函数内部存在循环引用，所以即使函数运行完毕，回到全局的执行上下文
// 但是a和b仍然身上有引用，所以不会被回收
```





### 标记清除

> 就是把“对象是否不再需要”简化定义为“对象是否可以获得”。
>
> 它假定有一个root对象（在`JavaScript`中就是全局对象），垃圾回收器将从根开始，找所有从根开始引用的对象，然后找这些对象引用的对象……从根开始，垃圾回收器将找到所有可以获得的对象和所有不能获得的对象。然后清除不能获得的对象

使用标记清除算法解决了循环引用的问题，因为即使函数内部两个对象循环引用，虽然他们身上存在被引用，但是无法被root对象获得，所以会被清除掉。

